import{x as I}from"./chunk-OX73WPYF.js";import{Z as f,ca as p,ce as v,ee as h}from"./chunk-S3HAZZOZ.js";var g=(()=>{class d{constructor(r,a){this.investmentService=r,this.currencyService=a}calculatePerformance(r,a,u=new Date){let n=this.investmentService.getInvestment(r);if(!n)return this.getEmptyMetrics(a,u);let s=this.investmentService.getInvestmentTransactions(r),o=s.filter(i=>{let m=new Date(i.date);return m>=a&&m<=u}),e=n.initialValue,t=n.initialValue;for(let i of s){if(new Date(i.date)>u)break;switch(i.type){case v.DEPOSIT:e+=i.amount,t+=i.amount;break;case v.WITHDRAWAL:e-=i.amount,t-=i.amount;break;case v.BALANCE_UPDATE:t=i.balance||t;break}}let c=t-e,l=e>0?c/e*100:0;return{totalInvested:e,currentBalance:t,totalReturn:c,returnPercentage:l,periodStart:a,periodEnd:u}}calculateOverallPerformance(r,a=new Date){let u=this.investmentService.getInvestments(),n=0,s=0;u.subscribe(t=>{t.forEach(c=>{let l=this.calculatePerformance(c.id,r,a);n+=this.currencyService.convertToBaseCurrency(l.totalInvested,c.currency,a),s+=this.currencyService.convertToBaseCurrency(l.currentBalance,c.currency,a)})});let o=s-n,e=n>0?o/n*100:0;return{totalInvested:n,currentBalance:s,totalReturn:o,returnPercentage:e,periodStart:r,periodEnd:a}}getHistoricalData(r,a,u=new Date){let n=this.investmentService.getInvestment(r);if(!n)return[];let s=this.investmentService.getInvestmentTransactions(r).filter(c=>{let l=new Date(c.date);return l>=a&&l<=u}),o=[],e=n.initialValue,t=n.initialValue;o.push({date:new Date(n.startDate),balance:e,invested:t,profitability:0});for(let c of s){switch(c.type){case v.DEPOSIT:t+=c.amount,e+=c.amount;break;case v.WITHDRAWAL:t-=c.amount,e-=c.amount;break;case v.BALANCE_UPDATE:e=c.balance||e;break}let l=t>0?(e-t)/t*100:0,i=this.currencyService.getBenchmarkData(new Date(c.date));o.push({date:new Date(c.date),balance:e,invested:t,profitability:l,cdi:i.CDI,ibovespa:i.IBOVESPA,dollar:i.DOLLAR})}return o}getConsolidatedByType(){let r=new Map;return this.investmentService.getInvestments().subscribe(u=>{u.forEach(n=>{let s=n.type,o=this.calculatePerformance(n.id,new Date(n.startDate),new Date),e={totalInvested:this.currencyService.convertToBaseCurrency(o.totalInvested,n.currency),currentBalance:this.currencyService.convertToBaseCurrency(o.currentBalance,n.currency),totalReturn:0,returnPercentage:0,periodStart:o.periodStart,periodEnd:o.periodEnd};if(e.totalReturn=e.currentBalance-e.totalInvested,e.returnPercentage=e.totalInvested>0?e.totalReturn/e.totalInvested*100:0,r.has(s)){let t=r.get(s);t.totalInvested+=e.totalInvested,t.currentBalance+=e.currentBalance,t.totalReturn=t.currentBalance-t.totalInvested,t.returnPercentage=t.totalInvested>0?t.totalReturn/t.totalInvested*100:0}else r.set(s,e)})}),r}getCurrentYearTransactions(){let r=new Date().getFullYear(),a=new Date(r,0,1),u=new Date(r,11,31),n=[],s=[];return this.investmentService.getTransactions().subscribe(o=>{o.forEach(e=>{let t=new Date(e.date);t>=a&&t<=u&&(e.type===v.DEPOSIT?n.push(e):e.type===v.WITHDRAWAL&&s.push(e))})}),{deposits:n,withdrawals:s}}getEmptyMetrics(r,a){return{totalInvested:0,currentBalance:0,totalReturn:0,returnPercentage:0,periodStart:r,periodEnd:a}}static{this.\u0275fac=function(a){return new(a||d)(p(I),p(h))}}static{this.\u0275prov=f({token:d,factory:d.\u0275fac,providedIn:"root"})}}return d})();export{g as a};
