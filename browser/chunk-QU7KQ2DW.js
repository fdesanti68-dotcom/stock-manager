import{a as bt,b as vt,c as yt,d as E,e as xt,f as St}from"./chunk-7FV2ELYY.js";import{a as wt}from"./chunk-WQMTMSAD.js";import{d as q}from"./chunk-PDO62T5Y.js";import{a as _t,b as Ct}from"./chunk-BQRRTEFI.js";import{a as J,b as K,c as X,d as tt,e as et,f as ot,g as lt,h as ct,i as st,j as mt,k as dt,l as pt,m as ut,n as gt,o as ft,p as ht,x as Tt}from"./chunk-OX73WPYF.js";import{$d as Mt,Ab as f,Bb as H,Bd as U,Ca as m,Cb as V,Da as y,Db as F,Eb as N,Ed as G,Fb as W,Hb as $,Kb as j,Kd as Z,Lb as Q,Ld as nt,Mb as w,Nd as at,Od as it,Pd as rt,Sa as p,Xa as g,Za as O,a as M,b as P,cc as z,ce as h,eb as a,ec as Y,ee as Dt,fb as n,ga as I,gb as x,hb as C,ib as b,kb as R,nb as A,oa as D,pa as S,pb as v,tb as B,ub as L,vb as k,yb as T,zb as i}from"./chunk-S3HAZZOZ.js";var Et=["chartCanvas"];function Pt(e,c){if(e&1&&(a(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),i(3,"Saldo Total"),n()(),a(4,"mat-card-content")(5,"div",15)(6,"div",16)(7,"div",17),i(8,"Investido"),n(),a(9,"div",18),i(10),n()(),a(11,"div",16)(12,"div",17),i(13,"Saldo Atual"),n(),a(14,"div",18),i(15),n()(),a(16,"div",16)(17,"div",17),i(18,"Rentabilidade"),n(),a(19,"div",18),i(20),n()()()()()),e&2){let t=v();m(10),f(t.formatCurrency(t.overallMetrics.totalInvested)),m(5),f(t.formatCurrency(t.overallMetrics.currentBalance)),m(4),O("positive",t.overallMetrics.totalReturn>=0)("negative",t.overallMetrics.totalReturn<0),m(),V(" ",t.formatCurrency(t.overallMetrics.totalReturn)," (",t.formatPercentage(t.overallMetrics.returnPercentage),") ")}}function It(e,c){e&1&&(a(0,"div",19),x(1,"canvas",null,2),n())}function Ot(e,c){e&1&&(a(0,"p",20),i(1,"Nenhum investimento cadastrado ainda."),n())}function Rt(e,c){e&1&&(a(0,"th",30),i(1,"Data"),n())}function At(e,c){if(e&1&&(a(0,"td",31),i(1),j(2,"appDate"),n()),e&2){let t=c.$implicit;m(),f(Q(2,1,t.date))}}function Bt(e,c){e&1&&(a(0,"th",30),i(1,"Investimento"),n())}function Lt(e,c){if(e&1&&(a(0,"td",31),i(1),n()),e&2){let t=c.$implicit;m(),f(t.investmentName)}}function kt(e,c){e&1&&(a(0,"th",30),i(1,"Tipo"),n())}function Ht(e,c){if(e&1&&(a(0,"td",31)(1,"mat-chip",32),i(2),n()()),e&2){let t=c.$implicit,r=v(2);m(),g("color",r.getTransactionTypeColor(t.type)),m(),H(" ",r.getTransactionTypeLabel(t.type)," ")}}function Vt(e,c){e&1&&(a(0,"th",30),i(1,"Valor"),n())}function Ft(e,c){if(e&1&&(a(0,"td",31),i(1),n()),e&2){let t=c.$implicit,r=v(2);m(),f(r.formatCurrency(t.amount))}}function Nt(e,c){e&1&&x(0,"tr",33)}function Wt(e,c){e&1&&x(0,"tr",34)}function $t(e,c){if(e&1&&(a(0,"table",21),C(1,22),p(2,Rt,2,0,"th",23)(3,At,3,3,"td",24),b(),C(4,25),p(5,Bt,2,0,"th",23)(6,Lt,2,1,"td",24),b(),C(7,26),p(8,kt,2,0,"th",23)(9,Ht,3,2,"td",24),b(),C(10,27),p(11,Vt,2,0,"th",23)(12,Ft,2,1,"td",24),b(),p(13,Nt,1,0,"tr",28)(14,Wt,1,0,"tr",29),n()),e&2){let t=v();g("dataSource",t.recentTransactions),m(13),g("matHeaderRowDef",t.displayedColumns),m(),g("matRowDefColumns",t.displayedColumns)}}function jt(e,c){e&1&&(a(0,"p",20),i(1,"Nenhuma movimenta\xE7\xE3o no ano corrente."),n())}E.register(...xt);var ge=(()=>{class e{constructor(t,r,o){this.investmentService=t,this.profitabilityService=r,this.currencyService=o,this.typeMetrics=[],this.recentTransactions=[],this.baseCurrency="BRL",this.selectedPeriod="current_year",this.displayedColumns=["date","investment","type","amount"]}ngOnInit(){this.loadDashboardData(),this.currencyService.getConfig().subscribe(t=>{this.baseCurrency=t.baseCurrency})}ngAfterViewInit(){this.createChart()}loadDashboardData(){this.overallMetrics=this.profitabilityService.calculateOverallPerformance(new Date(2e3,0,1),new Date),this.updateTypeMetrics();let{deposits:t,withdrawals:r}=this.profitabilityService.getCurrentYearTransactions(),o=[...t,...r].sort((s,d)=>new Date(d.date).getTime()-new Date(s.date).getTime()).slice(0,10);this.recentTransactions=o.map(s=>{let d=this.investmentService.getInvestment(s.investmentId);return P(M({},s),{investmentName:d?.name||"Unknown"})})}getPeriodDates(){let t=new Date,r=t.getFullYear();switch(this.selectedPeriod){case"current_year":return{startDate:new Date(r,0,1),endDate:t};case"previous_year":return{startDate:new Date(r-1,0,1),endDate:new Date(r-1,11,31)};case"last_5_years":return{startDate:new Date(r-5,0,1),endDate:t}}}updateTypeMetrics(){let{startDate:t,endDate:r}=this.getPeriodDates(),o=new Map;this.investmentService.getInvestments().subscribe(s=>{s.forEach(d=>{let l=this.profitabilityService.calculatePerformance(d.id,t,r),_=Mt[d.type]||d.type,u=o.get(_);u?(u.totalInvested+=l.totalInvested,u.currentBalance+=l.currentBalance,u.totalReturn+=l.totalReturn,u.returnPercentage=u.totalInvested>0?u.totalReturn/u.totalInvested*100:0):o.set(_,M({},l))}),this.typeMetrics=Array.from(o.entries()).map(([d,l])=>({type:d,metrics:l})),this.chart&&this.updateChart()})}onPeriodChange(){this.updateTypeMetrics()}createChart(){if(!this.chartCanvas)return;let t=this.chartCanvas.nativeElement.getContext("2d");if(!t)return;let r=this.typeMetrics.map(l=>l.type),o=this.typeMetrics.map(l=>l.metrics.returnPercentage),s=["rgba(63, 81, 181, 0.8)","rgba(233, 30, 99, 0.8)","rgba(0, 150, 136, 0.8)","rgba(255, 152, 0, 0.8)","rgba(156, 39, 176, 0.8)","rgba(76, 175, 80, 0.8)"],d={type:"bar",data:{labels:r,datasets:[{label:"Rentabilidade (%)",data:o,backgroundColor:s.slice(0,o.length),borderColor:s.slice(0,o.length).map(l=>l.replace("0.8","1")),borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:l=>{let _=l.parsed.y;return`Rentabilidade: ${_>=0?"+":""}${_.toFixed(2)}%`}}}},scales:{y:{beginAtZero:!0,ticks:{callback:l=>`${l}%`}}}}};this.chart=new E(t,d)}updateChart(){if(!this.chart)return;let t=this.typeMetrics.map(o=>o.type),r=this.typeMetrics.map(o=>o.metrics.returnPercentage);this.chart.data.labels=t,this.chart.data.datasets[0].data=r,this.chart.update()}getTransactionTypeLabel(t){switch(t){case h.DEPOSIT:return"Aporte";case h.WITHDRAWAL:return"Saque";case h.BALANCE_UPDATE:return"Atualiza\xE7\xE3o";default:return t}}getTransactionTypeColor(t){switch(t){case h.DEPOSIT:return"primary";case h.WITHDRAWAL:return"warn";default:return"accent"}}formatCurrency(t){return this.currencyService.formatCurrency(t,this.baseCurrency)}formatPercentage(t){return`${t>=0?"+":""}${t.toFixed(2)}%`}static{this.\u0275fac=function(r){return new(r||e)(y(Tt),y(wt),y(Dt))}}static{this.\u0275cmp=I({type:e,selectors:[["app-dashboard"]],viewQuery:function(r,o){if(r&1&&B(Et,5),r&2){let s;L(s=k())&&(o.chartCanvas=s.first)}},standalone:!0,features:[$],decls:37,vars:6,consts:[["noData",""],["noTransactions",""],["chartCanvas",""],[1,"dashboard-container"],[4,"ngIf"],[1,"period-selector"],[3,"ngModelChange","change","ngModel"],["value","current_year"],["value","previous_year"],["value","last_5_years"],["class","chart-container",4,"ngIf","ngIfElse"],["mat-table","",3,"dataSource",4,"ngIf","ngIfElse"],[1,"actions"],["mat-raised-button","","color","primary","routerLink","/investments"],["mat-raised-button","","color","accent","routerLink","/settings"],[1,"metrics-grid"],[1,"metric"],[1,"metric-label"],[1,"metric-value"],[1,"chart-container"],[1,"no-data"],["mat-table","",3,"dataSource"],["matColumnDef","date"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","investment"],["matColumnDef","type"],["matColumnDef","amount"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["highlighted","",3,"color"],["mat-header-row",""],["mat-row",""]],template:function(r,o){if(r&1){let s=R();a(0,"div",3)(1,"h1"),i(2,"Dashboard"),n(),p(3,Pt,21,8,"mat-card",4),a(4,"mat-card")(5,"mat-card-header")(6,"mat-card-title"),i(7,"Rentabilidade por Tipo"),n()(),a(8,"mat-card-content")(9,"div",5)(10,"mat-button-toggle-group",6),W("ngModelChange",function(l){return D(s),N(o.selectedPeriod,l)||(o.selectedPeriod=l),S(l)}),A("change",function(){return D(s),S(o.onPeriodChange())}),a(11,"mat-button-toggle",7),i(12,"Ano Corrente"),n(),a(13,"mat-button-toggle",8),i(14,"Ano Anterior"),n(),a(15,"mat-button-toggle",9),i(16,"\xDAltimos 5 Anos"),n()()(),p(17,It,3,0,"div",10)(18,Ot,2,0,"ng-template",null,0,w),n()(),a(20,"mat-card")(21,"mat-card-header")(22,"mat-card-title"),i(23,"Movimenta\xE7\xF5es Recentes (Ano Corrente)"),n()(),a(24,"mat-card-content"),p(25,$t,15,3,"table",11)(26,jt,2,0,"ng-template",null,1,w),n()(),a(28,"div",12)(29,"button",13)(30,"mat-icon"),i(31,"trending_up"),n(),i(32," Ver Investimentos "),n(),a(33,"button",14)(34,"mat-icon"),i(35,"settings"),n(),i(36," Configura\xE7\xF5es "),n()()()}if(r&2){let s=T(19),d=T(27);m(3),g("ngIf",o.overallMetrics),m(7),F("ngModel",o.selectedPeriod),m(7),g("ngIf",o.typeMetrics.length>0)("ngIfElse",s),m(8),g("ngIf",o.recentTransactions.length>0)("ngIfElse",d)}},dependencies:[Y,z,q,Z,U,G,et,J,X,tt,K,at,nt,rt,it,ht,ot,ct,pt,st,lt,ut,mt,dt,gt,ft,Ct,_t,yt,bt,vt,St],styles:[".dashboard-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:20px}h1[_ngcontent-%COMP%]{margin-bottom:20px;color:#333}mat-card[_ngcontent-%COMP%]{margin-bottom:20px}.metrics-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-top:20px}.metric[_ngcontent-%COMP%]{text-align:center}.metric-label[_ngcontent-%COMP%]{font-size:14px;color:#666;margin-bottom:8px}.metric-value[_ngcontent-%COMP%]{font-size:24px;font-weight:500;color:#333}.period-selector[_ngcontent-%COMP%]{margin-bottom:20px;display:flex;justify-content:center}.chart-container[_ngcontent-%COMP%]{position:relative;height:400px;width:100%;margin-top:20px}.type-metrics[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.type-item[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr 1fr;gap:16px;padding:12px;background-color:#f5f5f5;border-radius:4px;align-items:center}.type-name[_ngcontent-%COMP%]{font-weight:500}.type-balance[_ngcontent-%COMP%]{text-align:right}.type-return[_ngcontent-%COMP%]{text-align:right;font-weight:500}table[_ngcontent-%COMP%]{width:100%}.actions[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:center;margin-top:20px}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.no-data[_ngcontent-%COMP%]{text-align:center;color:#666;padding:20px}.positive[_ngcontent-%COMP%]{color:#4caf50}.negative[_ngcontent-%COMP%]{color:#f44336}@media (max-width: 768px){.type-item[_ngcontent-%COMP%]{grid-template-columns:1fr;text-align:center}.type-balance[_ngcontent-%COMP%], .type-return[_ngcontent-%COMP%]{text-align:center}.actions[_ngcontent-%COMP%]{flex-direction:column}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}"]})}}return e})();export{ge as DashboardComponent};
